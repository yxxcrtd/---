function encodePwd(e){var n=new JSEncrypt;return n.setPublicKey(window.PUBLICKEY),n.encrypt2Hex(e)}function reg(){function e(){v.src=v.src}function n(){if(!g){if(S.mob=f.box1[0].value,S.captcha=m.value,""==S.mob)return u.innerHTML='<i class="icons"></i>请输入手机号',void(u.className="error");if(!S.captcha)return u.innerHTML='<i class="icons"></i>验证码没有输入，请检查输入',void(u.className="error");u.className="hidden",r(),g=1,b.ajax({type:"POST",url:"/sms/registercode",data:{mobile:S.mob,captcha:m.value},success:function(e){e.success?mobile=S.mob:(u.innerHTML='<i class="icons"></i>'+e.msg,u.className="error",o())}})}}function r(){T--,c&&clearTimeout(c),p.innerHTML=T+"秒后重试",T?c=setTimeout(r,1e3):o()}function o(){T=60,g=0,c&&clearTimeout(c),c=null,p.innerHTML="获取验证码"}function t(){return S.code=f.box1[2].value,S.mob=f.box1[0].value,""==S.code?(u.innerHTML='<i class="icons"></i>请输入短信验证码',void(u.className="error")):void b.ajax({type:"POST",url:"/user/mobile/check",data:{mobile:S.mob},success:function(e){e.success?(s.style.display="none",a.style.display="block"):(u.innerHTML='<i class="icons"></i>'+e.msg,u.className="error",o())}})}function i(e){var n=f.box2[0].value,r=f.box2[1].value;return Event.stop(e),n&&r?n.length<6?(d.innerHTML='<i class="icons"></i>密码不能短于6位',void(d.className="error")):n!=r?(d.innerHTML='<i class="icons"></i>两次输入的密码不相同，请重新输入',void(d.className="error")):(d.className="success",d.innerHTML='<i class="icons"></i>请求发送中请稍后',void b.ajax({url:"/user/register",data:{mobile:S.mob,loginPwd:encodePwd(n),smsCode:S.code},type:"POST",success:function(e){return e.success?void b.ajax({url:"/user/login",type:"POST",data:{loginName:S.mob,loginPwd:encodePwd(n)},success:function(){a.style.display="none",l.style.display="block"}}):(d.innerHTML='<i class="icons"></i>'+e.msg,void(d.className="error"))}})):(d.innerHTML='<i class="icons"></i>密码和确认密码都是必填项',void(d.className="error"))}var c,s=document.querySelector("#reg1"),a=document.querySelector("#reg2"),l=document.querySelector("#reg3"),u=document.querySelector("#notice1"),d=document.querySelector("#notice2"),m=document.querySelector("#captcha"),v=document.querySelector("#captchaPic"),p=document.querySelector("#getMobCode"),y=document.querySelector("#regBtn"),N=document.querySelector("#submit"),f={box1:s.querySelectorAll("input"),box2:a.querySelectorAll("input")},b=request(),T=60,g=0,S={};Event.add(v,"click",e),function(){Event.add(p,"click",n),Event.add(y,"click",t),Event.add(N,"click",i)}()}function login(){function e(e){return Event.stop(e),l.mob=t.value,l.pwd=i.value,l.captcha=c.value,u>=3&&!l.captcha?(notice.innerHTML='<i class="icons"></i>验证码没有输入，请检查输入',void(notice.className="error")):l.mob?l.pwd?void a.ajax({url:"/user/loginErrorCount",type:"GET",data:{loginName:l.mob},success:function(e){e.success&&(u=1*e.data,u>=3&&!c.value?(c.parentNode.className="col",r()):n())}}):(notice.innerHTML='<i class="icons"></i>密码没有输入，请检查输入',void(notice.className="error")):(notice.innerHTML='<i class="icons"></i>手机号没有输入，请检查输入',void(notice.className="error"))}function n(){var e=encodePwd(l.pwd);a.ajax({url:"/user/login",type:"POST",data:{loginName:l.mob,loginPwd:e,captcha:c.value},success:function(e){return e.success?void(window.REF&&(window.location.href=REF)):(notice.innerHTML='<i class="icons"></i>'+e.msg,void(notice.className="error"))}})}function r(){s.src=s.src}var o=document.querySelector("#btn"),t=document.querySelector("#loginName"),i=document.querySelector("#loginPwd"),c=document.querySelector("#captcha"),s=document.querySelector("#captchaPic"),a=request(),l={},u=0;Event.add(o,"click",e),Event.add(s,"click",r)}function accountList(e){var n=document.querySelector("#"+e);Event.add(n,"click",function(e){var n,r=Event.target(e);(n=r.getAttribute("action"))&&(Event.stop(e),"showHide"==n&&(r.getAttribute("isopen")?(r.innerHTML="展开",r.removeAttribute("isopen"),!dom.hasClass(r.parentNode,"grayTit")&&dom.addClass(r.parentNode,"grayTit"),r.parentNode.parentNode.querySelector("table").className=""):(r.innerHTML="收起",r.setAttribute("isopen",1),dom.hasClass(r.parentNode,"grayTit")&&dom.removeClass(r.parentNode,"grayTit"),r.parentNode.parentNode.querySelector("table").className="cur")))})}function infoList(e){var n=document.querySelector("#"+e),r=request();Event.add(n,"click",function(e){var n,o,t,i,c,s,a=Event.target(e),l={nickName:"",address:"",qq:"",weixin:""};if(n=a.getAttribute("action")){if(Event.stop(e),"showHide"==n)return c=a.parentNode.parentNode.querySelector("div.form"),s=a.parentNode.parentNode.querySelector("div.name"),void(a.getAttribute("isopen")?(a.innerHTML="修改",a.removeAttribute("isopen"),c.style.display="none",s.style.display="block"):(a.innerHTML="取消",a.setAttribute("isopen",1),s.style.display="none",c.style.display="block"));if("submit"==n){if(o=a.parentNode.parentNode.parentNode,i=o.querySelector(".icons").parentNode,t=o.querySelector("input"),c=o.parentNode.querySelector("div.form"),s=o.parentNode.querySelector("div.name"),!t.value)return i.innerHTML='<i class="icons"></i>输入不能为空',void(i.className="error");l[a.getAttribute("name")]=t.value,r.ajax({url:"/user/update_info",type:"POST",data:l,success:function(e){e.success?(o.parentNode.parentNode.querySelector("a[action='showHide']").innerHTML="修改",o.parentNode.parentNode.querySelector("a[action='showHide']").removeAttribute("isopen"),c.style.display="none",s.style.display="block",s.innerHTML=t.value):(i.innerHTML='<i class="icons"></i>'+e.msg,i.className="error")}})}}})}function setNewPwd(e,n){function r(r){var a=Event.target(r),l=a.getAttribute("action");if(l&&(Event.stop(r),console.log(e),"submit"==l)){if(!c[0].value)return i.innerHTML='<i class="icons"></i>原密码没有填写',void(i.className="error");if(!c[1].value)return i.innerHTML='<i class="icons"></i>新密码没有填写',void(i.className="error");if(!c[2].value)return i.innerHTML='<i class="icons"></i>确认新密码没有填写',void(i.className="error");if(c[1].value.length<6)return i.innerHTML='<i class="icons"></i>密码不能短于6位',void(i.className="error");if(c[1].value!=c[2].value)return i.innerHTML='<i class="icons"></i>两次新密码填写的不相同，请确认重新填写',void(i.className="error");n.oldPwd=encodePwd(c[0].value),n.newPwd=encodePwd(c[1].value),s.ajax({type:"POST",url:e||"/user/loginpwd/reset",data:n,success:function(e){e.success?(o.style.display="none",t.style.display="block"):(i.innerHTML='<i class="icons"></i>'+e.msg,i.className="error")}})}}var o=document.querySelector("#step1"),t=document.querySelector("#step2"),i=document.querySelector("#notice"),c=o.querySelectorAll("input"),n=n||{},s=request();Event.add(o,"click",r)}function setGJSNewPwd(e,n){function r(r){var a=Event.target(r),l=a.getAttribute("action");if(l&&(Event.stop(r),console.log(e),"submit"==l)){if(!c[0].value)return i.innerHTML='<i class="icons"></i>原密码没有填写',void(i.className="error");if(!c[1].value)return i.innerHTML='<i class="icons"></i>新密码没有填写',void(i.className="error");if(!c[2].value)return i.innerHTML='<i class="icons"></i>确认新密码没有填写',void(i.className="error");if(c[1].value!=c[2].value)return i.innerHTML='<i class="icons"></i>两次新密码填写的不相同，请确认重新填写',void(i.className="error");n.oldPwd=encodePwd(c[0].value),n.newPwd=encodePwd(c[1].value),s.ajax({type:"POST",url:e||"/user/loginpwd/reset",data:n,success:function(e){e.success?(o.style.display="none",t.style.display="block"):(i.innerHTML='<i class="icons"></i>'+e.msg,i.className="error")}})}}var o=document.querySelector("#step1"),t=document.querySelector("#step2"),i=document.querySelector("#notice"),c=o.querySelectorAll("input"),n=n||{},s=request();Event.add(o,"click",r)}