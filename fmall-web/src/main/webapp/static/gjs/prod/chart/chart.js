function chart(){function e(e){var o=0,t=0,s=e||l.size,i=s.w>g.options.user.outRuleWidth;g.loading.close(),l.canvasLayout(s,f),!g.kBox&&s.w>480&&(g.kBox=r("-299px","20px","stockMoreInfo")),(g.options.data.DATA.length||g.options.data.DATAT.data.length)&&(g.options.curLevel=g.options.level[g.options.user.level],o=~~((g.options.user.w-(g.options.user.timeShare?2*(i?g.options.user.ruleWidth:0):i?g.options.user.ruleWidth:0)-g.options.user.paddingRight)/g.options.curLevel[0]),t=g.options.user.timeShare?g.options.data.DATAT.data.length:g.options.data.DATA.length,g.options.lens=o>t?t:o,g.options.dataOffset=t>o?t-o:0,g.formatTimeData(l.size.w-2*(i?g.options.user.ruleWidth:0)-2,i?g.options.user.ruleWidth:0),g.options.user.timeShare?(c[1].clearVol(),u[1].clearK(),p[1].clearInd(),m[1].clearTimeShare(),m[1].drawTimeShare(m[2],"timeShare",l),m[2].style.top="0",h[1].clearVol(),h[1].drawTimeVol(l),h[2].style.top=m[1].h+"px",u[2].style.top="-99px",c[2].style.top="-99px",p[2].style.top="-99px",g.kBox&&(g.kBox.style.left="-299px")):(m[1].clearTimeShare(),h[1].clearVol(),u[1].clearK(),u[1].drawKLine(u[2],"k"),u[2].style.top="0",c[1].clearVol(),c[1].drawVol(c[2],"vol"),c[2].style.top=u[1].h+"px",p[1].clearInd(),p[1].drawInd(p[2]),p[2].style.top=1*u[1].h+1*c[1].h+"px",m[2].style.top="-99px",h[2].style.top="-99px"),l.splitWindows(),g.fillCurData(null))}function o(e,o){if("timeshare"===e||"timeshare"===o){if(g.options.user.timeShare)return;return g.options.user.timeShare=1,g.options.user.ctrlVer=1*new Date,g.options.user.cyc="timeshare",g.options.layout=[1,1,1],window.ISCHART&&(HASINDKEY=0),void g.getNewStock()}if("k"===e||"k"===o){if(!g.options.user.timeShare)return;return g.options.user.timeShare=0,g.options.user.ctrlVer=1*new Date,window.ISCHART&&(HASINDKEY=1),void g.getNewStock()}return"list"===e||"list"===o?void(window.location.href="index.html"):(g.options.user.timeShare=!g.options.user.timeShare,g.options.user.timeShare&&(g.options.user.cyc="1day",g.options.layout=[1,1,1]),g.options.user.ctrlVer=1*new Date,g.getNewStock(),void(window.ISCHART&&(HASINDKEY=!g.options.user.timeShare)))}function t(e,o){(g.options.user.vIndicator.toLowerCase()!=e.toLowerCase()||o)&&(g.options.user.vIndicator=e,g.options.user.ctrlVer=1*new Date,g.options.user.timeShare&&(g.options.user.timeShare=0),g.getNewStock())}function s(o){var t=g.options.user.level,s=g.options.level.length;t+=1*o,0>t&&(t=0),t>=s&&(t=s-1),g.options.user.level=t,e()}function i(e){g.domlist=e}function n(){var e=document.createElement("canvas"),o=e.getContext("2d");return J(_dash,o,g),o.lineCap="round",e.style.cssText+=";position:absolute;left:0;top:0;",l.appendChild(e),J(_kline,o,g),J(_timeShare,o,g),J(_vol,o,g),J(_indicator,o,g),J(_bgLine,o,g),J(_tools,o,g,l),[e,o]}function r(e,o,t){var s=document.createElement("p");return s.className="stockInfo "+(t?t:""),s.style.cssText=";position:absolute;left:"+(e||"5px")+";top:"+(o||"-99px")+";line-height:20px;",l.appendChild(s),s}function a(e,o){g.changeStock({code:e,ex:o})}var l,u,c,p,d,m,h,f,v,g={options:{}};return!function(e,o){"construct";l=e&&"string"==typeof e?document.getElementById(e):e,l&&(copy(g.options,o||CFG),u=n(),c=n(),p=n(),m=n(),h=n(),d=n(),f={mainCanvas:u,volCanvas:c,indCanvas:p,toolsCanvas:d,timeCanvas:m,timeVolCanvas:h},f.mainCanvas[2]=r(),f.volCanvas[2]=r(),f.indCanvas[2]=r(),f.timeCanvas[2]=r(),f.timeVolCanvas[2]=r(),g.options.level.reverse(),J(_canvasLayout,l,g),J(_domctrl,g),J(_keymap,g),v=document.createElement("div"),v.innerHTML="<div style='text-align:center;line-height:500px;font-size:30px;height:552px;background:#fff;'>loading</div>",v.className="loading",J(_loading,g,l.appendChild(v)),J(_event,g,l,f),J(_dataExchange,g),J(_fillData,g,l),g.tradeStatus=1,g.fillData={},g.fillBoxs={},window.ISCHART&&(HASINDKEY=!g.options.user.timeShare))}.apply(window,arguments),g.draw=e,g.kt=o,g.setInd=t,g.setLevel=s,{draw:e,toStock:a,box:l,stockChart:g,setLevel:s,setdomlist:i,kt:o,setInd:t}}function _kline(e){function o(){var o=c-p;return o?(l.h-e.options.user.offsetTop)*e.options.user.drawRange/o:0}function t(e){return 1*((c-e)*r).toFixed()+1*a+.5}function s(o,t,s,i,n){var r=n?e.options.schemes[e.options.user.schemes].riseStyle:e.options.schemes[e.options.user.schemes].fallStyle;1*r&&l.fillRect(o,t,s,i),i?l.rect(o,t,s,i):(l.moveTo(o,t),l.lineTo(o+s,t))}function i(i,n){i.index=n;var a,c,p,h,f,v,g=1*i.cur>=1*i.open,T=g?e.options.schemes[e.options.user.schemes].rise:e.options.schemes[e.options.user.schemes].fall,w=e.options.level[e.options.user.level],y=w[0]/2!=(w[0]/2).toFixed();return r||(r=o()),l.strokeStyle=T,l.fillStyle=T,l.beginPath(),c=w[0]*n+w[0]/2+(y?0:.5),c>l.w-w[0]?null:(f=t(i.high),v=t(i.low),w[1]>2?(a=c-w[1]/2+.5,g?(p=t(i.cur),h=t(i.open)-p):(p=t(i.open),h=t(i.cur)-p),s(a,p,w[1],h,g),l.moveTo(c,f),l.lineTo(c,p),l.moveTo(c,p+h),l.lineTo(c,v)):(l.moveTo(c,f),l.lineTo(c,v==f?f+.5:v)),l.stroke(),(d==i.high||m==i.low)&&(l.strokeStyle=e.options.schemes[e.options.user.schemes].fontColor,l.fillStyle=e.options.schemes[e.options.user.schemes].fontColor,l.beginPath(),l.font="12px arial"),e.options.user.showHigh&&d==i.high&&!u.high&&(l.moveTo(c+18,f-13*u.highCount),l.lineTo(c,f-13*u.highCount),l.lineTo(c,f),l.lineTo(c+3,f-5),l.moveTo(c,f),l.lineTo(c-3,f-5),l.fillText(cutFixed(i.high,2),c+20,f-13*u.highCount),l.stroke(),u.high=1),void(e.options.user.showLow&&m==i.low&&!u.low&&(l.moveTo(c+10,v+13*u.lowCount),l.lineTo(c,v+13*u.lowCount),l.lineTo(c,v),l.lineTo(c+3,v+5),l.moveTo(c,v),l.lineTo(c-3,v+5),l.fillText(cutFixed(i.low,2),c+10,v+13*u.lowCount),l.stroke(),u.low=1)))}function n(){var o,s=(e.options.data.IND.KMA.length,e.options.lens-1),i=[].concat(e.options.data.IND.KMA).reverse().slice(0,e.options.lens),n=e.options.level[e.options.user.level],r=n[0]/2!=(n[0]/2).toFixed(),a=0,u=Math.min(e.options.lens,i.length);l.lineWidth=1.5;for(var c in i[0]){l.beginPath(),o=n[0]*s+n[0]/2+(r?0:.5),l.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[a++],l.moveTo(o,t(i[0][c]));for(var p=0;u>p;p++)1*i[p][c]&&(o=n[0]*(s-p)+n[0]/2+(r?0:.5),l.lineTo(o,t(i[p][c])));l.stroke()}return i}var r,a,l=this,u={low:null,lowCount:1,highCount:1,high:null},c=Number.MIN_VALUE,p=Number.MAX_VALUE,d=Number.MIN_VALUE,m=Number.MAX_VALUE;l.drawKLine=function(t,s){for(var u,h=(e.options.data.DATA.length,e.options.lens-1),f=[].concat(e.options.data.DATA).reverse().slice(0,e.options.lens),v=.3,g=0,T=0;T<e.options.lens;T++)c=Math.max(f[T].high,c),p=Math.min(f[T].low,p);v>c-p&&(g=Math.ceil(100*(v-Math.abs(c-p))/2)/100),d=c,m=p,c+=g,p-=g,r=o(),l.drawLine(c,p,r,2),a=~~((l.h-e.options.user.offsetTop)*(.5-e.options.user.drawRange/2)+e.options.user.offsetTop);for(var T=0;T<e.options.lens;T++)i(f[T],h-T);u=e.options.data.IND.KMA&&n(),e.fillData[s]={data:f,ind:u,name:e.options.data.DATA2.name||""},e.fillBoxs[s]=t},l.clearK=function(){l.clearRect(0,0,l.w,l.h),r=!1,c=Number.MIN_VALUE,p=Number.MAX_VALUE,d=Number.MIN_VALUE,m=Number.MAX_VALUE,a=null,u={low:null,lowCount:1,highCount:1,high:null}}}function _timeShare(e){function o(){var o,t,s=e.options.user.timeLineMinRuleHeight,n=~~((r.h-e.options.user.offsetTop)/s),u=~~((r.h-e.options.user.offsetTop)/2+e.options.user.offsetTop),c=a-l;return n=n%2?n-1:n,o=(r.h-e.options.user.offsetTop)/n,t=u-o*(n/2-1),i=~~t,c?o*(n-2)/c:0}function t(e){return 1*((a-e)*s).toFixed()+1*i+.5}var s,i,n,r=this,a=Number.MIN_VALUE,l=Number.MAX_VALUE;r.drawTimeShare=function(i,u,c){var p,d,m=(e.options.data.DATAT.formatData.length,[].concat(e.options.data.DATAT.data).reverse()),h=[].concat(e.options.data.DATAT.formatData).reverse(),f=h.length,v=m[0].preClosePx.toFixed(2),g=c.size.w>e.options.user.outRuleWidth;r.clearRect(0,0,r.w,r.h);for(var T=0,w=m.length;w>T;T++)a=Math.max(m[T].pri,a),l=Math.min(m[T].pri,l);.2>a-l&&(a+=.2,l-=.2),p=[a-v,v-l],p[0]>p[1]?l=v-p[0]:a=1*v+1*p[1],s=o(),r.drawTimeLine(a,l,s,2,v,g),r.beginPath(),r.lineWidth=1.5,r.moveTo(h[0].x,t(h[0].drawData.pri)),r.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[0];for(var T=0;f>T;T++)r.lineTo(h[T].x,t(h[T].drawData.pri));if(r.stroke(),e.options.schemes[e.options.user.schemes].timeShareShadow){r.beginPath();for(var T=0;f>T;T++)r.lineTo(h[T].x,t(h[T].drawData.pri)),d=h[T];r.lineTo(d.x,r.h),r.lineTo(h[0].x,r.h),r.closePath(),r.fillStyle=e.options.schemes[e.options.user.schemes].shadowFill,r.fill()}r.beginPath(),r.moveTo(h[0].x,t(h[0].drawData.avg)),r.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[1];for(var T=0;f>T;T++)r.moveTo(h[T].x,t(v));n=1,r.stroke(),e.fillData[u]={data:h,name:e.options.data.DATA2.name||""},e.fillBoxs[u]=i},r.clearTimeShare=function(){a=Number.MIN_VALUE,l=Number.MAX_VALUE,s=null,i=null}}function _dash(){var e=this;e.lastMoveToLocation||(e.moveForDashed=function(o,t){e.moveTo(o,t),e.lastMoveToLocation.x=o,e.lastMoveToLocation.y=t}),e.lastMoveToLocation={},e.dashedLineTo=function(o,t,s){for(var i,n,s=void 0===s?3:s,r=e.lastMoveToLocation.x,a=e.lastMoveToLocation.y,l=o-r,u=t-a,c=Math.floor(Math.sqrt(l*l+u*u)/s),p=0;c>p;++p)i=r+l/c*p,n=a+u/c*p,p%2===0?e.moveForDashed(i,n):e.lineTo(i,n);e.moveForDashed(o,t)}}function _vol(e){function o(){var o=p-d;return o?(c.h-e.options.user.offsetTop)/o:0}function t(e){return 1*((p-e)*a).toFixed()+1*l+.5}function s(s,i,r,l){var u,p,d,m=s.vol,h=e.options.level[e.options.user.level],f=1*s.cur>=1*s.open,v=f?e.options.schemes[e.options.user.schemes].rise:e.options.schemes[e.options.user.schemes].fall,g=h[0]/2!=(h[0]/2).toFixed();c.strokeStyle=v,c.lineWidth=1,c.fillStyle=v,c.beginPath(),a||(a=o()),u=t(m),d=h[0]*i+h[0]/2+(g?0:.5)+r,h[1]>1&&!l?(p=d-h[1]/2+.5,n(p,u,h[1],c.h,f)):(c.moveTo(d,u),c.lineTo(d,c.h),c.stroke()),c.stroke()}function i(){var o,s=(e.options.data.IND.VMA.length,e.options.lens-1),i=[].concat(e.options.data.IND.VMA).reverse().slice(0,e.options.lens),n=e.options.level[e.options.user.level],r=n[0]/2!=(n[0]/2).toFixed(),a=0,l=Math.min(e.options.lens,i.length);c.lineWidth=1.5;for(var u in i[0]){c.beginPath(),o=n[0]*s+n[0]/2+(r?0:.5),c.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[a++],c.moveTo(o,t(i[0][u]));for(var p=0;l>p;p++)1*i[p][u]&&(o=n[0]*(s-p)+n[0]/2+(r?0:.5),c.lineTo(o,t(i[p][u])));c.stroke()}return i}function n(o,t,s,i,n){var r=n?e.options.schemes[e.options.user.schemes].riseStyle:e.options.schemes[e.options.user.schemes].fallStyle;1*r&&c.fillRect(o,t,s,i),i?c.rect(o,t,s,i):(c.moveTo(o,t),c.lineTo(o+s,t))}function r(s,i){var n,r=s.drawData.vol;c.lineWidth=1,c.strokeStyle=i&&1*s.drawData.pri!=1*u?1*s.drawData.pri<1*u?e.options.schemes[e.options.user.schemes].timeVolFall:e.options.schemes[e.options.user.schemes].timeVolRise:e.options.schemes[e.options.user.schemes].timeVolStable,u=s.drawData.pri,c.beginPath(),a||(a=o()),n=t(r),c.moveTo(1*s.x+.5,n),c.lineTo(1*s.x+.5,c.h),c.stroke()}var a,l,u,c=this,p=Number.MIN_VALUE,d=Number.MAX_VALUE;c.drawVol=function(t,n){for(var r=(e.options.data.DATA.length,e.options.lens-1),u=[].concat(e.options.data.DATA).reverse().slice(0,e.options.lens),m=0,h=u.length;h>m;m++)p=Math.max(u[m].vol,p);d=0,a=o(),l=e.options.user.offsetTop,c.drawLine(p,d,a,0,1,null,1);for(var m=0,h=u.length;h>m;m++)s(u[m],r-m,0);ind=e.options.data.IND.VMA&&i(),e.fillData[n]={data:u,ind:ind},e.fillBoxs[n]=t},c.drawTimeVol=function(){for(var t=(e.options.data.DATAT.formatData.length,[].concat(e.options.data.DATAT.data).reverse()),s=[].concat(e.options.data.DATAT.formatData).reverse(),i=0,n=t.length;n>i;i++)p=Math.max(t[i].vol,p);d=0,u=s[0].drawData.pri,a=o(),l=e.options.user.offsetTop,c.drawLine(p,d,a,1,1,null,1);for(var i=0,n=s.length;n--;i++)r(s[n],i,e.options.user.ruleWidth,1)},c.clearVol=function(){c.clearRect(0,0,c.w,c.h),p=Number.MIN_VALUE,d=Number.MAX_VALUE,a=null,l=null}}function _indicator(e){function o(){var o=r-a;return o?(i.h-e.options.user.offsetTop)*e.options.user.drawRange/o:0}function t(e){return 1*((r-e)*n).toFixed()+1*verticalOffset+.5}function s(){delete e.fillData.MACD,delete e.fillBoxs.MACD,delete e.fillData.KDJ,delete e.fillBoxs.KDJ,delete e.fillData.MTM,delete e.fillBoxs.MTM,delete e.fillData.RSI,delete e.fillBoxs.RSI}var i=this,n=null,r=Number.MIN_VALUE,a=Number.MAX_VALUE,l={};l.MACD=function(s){if(e.options.data.IND.MACD){for(var l,u=(e.options.data.IND.MACD.length,e.options.lens-1),c=[].concat(e.options.data.IND.MACD).reverse().slice(0,e.options.lens),p=e.options.level[e.options.user.level],d=p[0]/2!=(p[0]/2).toFixed(),m=p[0]*u+p[0]/2+(d?0:.5),h=0,f=c.length;f>h;h++)c[h].dea=1*(c[h].dea/100).toFixed(2),c[h].dif=1*(c[h].dif/100).toFixed(2),c[h].macd=1*(c[h].macd/100).toFixed(2),r=Math.max(c[h].dea,r),r=Math.max(c[h].dif,r),r=Math.max(c[h].macd,r),a=Math.min(c[h].dea,a),a=Math.min(c[h].dif,a),a=Math.min(c[h].macd,a);n=o(),verticalOffset=~~((i.h-e.options.user.offsetTop)*(.5-e.options.user.drawRange/2)+e.options.user.offsetTop),i.drawLine(r,a,n,2),i.drawZeroLine(t(0));for(var h=0,f=c.length;f>h;h++)i.beginPath(),i.lineWidth=1,l=c[h].macd>0?"MACDrise":"MACDfall",i.strokeStyle=e.options.schemes[e.options.user.schemes][l],m=p[0]*(u-h)+p[0]/2+(d?0:.5),i.moveTo(m,t(c[h].macd)),i.lineTo(m,t(0)),i.stroke();i.beginPath(),i.lineWidth=1.5,m=p[0]*u+p[0]/2+(d?0:.5),i.moveTo(m,t(c[0].dea)),i.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[1];for(var h=0,f=c.length;f>h;h++)m=p[0]*(u-h)+p[0]/2+(d?0:.5),i.lineTo(m,t(c[h].dea));i.stroke(),i.beginPath(),m=p[0]*u+p[0]/2+(d?0:.5),i.moveTo(m,t(c[0].dif)),i.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[0];for(var h=0,f=c.length;f>h;h++)m=p[0]*(u-h)+p[0]/2+(d?0:.5),i.lineTo(m,t(c[h].dif));i.stroke(),e.fillData[e.options.user.vIndicator.toUpperCase()]={data:c},e.fillBoxs[e.options.user.vIndicator.toUpperCase()]=s}},l.KDJ=function(l){if(e.options.data.IND.KDJ){for(var u=(e.options.data.IND.KDJ.length,e.options.lens-1),c=[].concat(e.options.data.IND.KDJ).reverse().slice(0,e.options.lens),p=e.options.level[e.options.user.level],d=p[0]/2!=(p[0]/2).toFixed(),m=p[0]*u+p[0]/2+(d?0:.5),h=0,f=c.length;f>h;h++)c[h].k=1*(c[h].k/100).toFixed(2),c[h].d=1*(c[h].d/100).toFixed(2),c[h].j=1*(c[h].j/100).toFixed(2),r=Math.max(c[h].k,r),r=Math.max(c[h].d,r),r=Math.max(c[h].j,r),a=Math.min(c[h].k,a),a=Math.min(c[h].d,a),a=Math.min(c[h].j,a);r=100,a=0,n=o(),verticalOffset=~~((i.h-e.options.user.offsetTop)*(.5-e.options.user.drawRange/2)+e.options.user.offsetTop),i.drawLine(r,a,n,2),i.beginPath(),i.lineWidth=1.5,m=p[0]*u+p[0]/2+(d?0:.5),i.moveTo(m,t(c[0].k)),i.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[0];for(var h=0,f=c.length;f>h;h++)m=p[0]*(u-h)+p[0]/2+(d?0:.5),i.lineTo(m,t(c[h].k));i.stroke(),i.beginPath(),i.lineWidth=1.5,m=p[0]*u+p[0]/2+(d?0:.5),i.moveTo(m,t(c[0].d)),i.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[1];for(var h=0,f=c.length;f>h;h++)m=p[0]*(u-h)+p[0]/2+(d?0:.5),i.lineTo(m,t(c[h].d));i.stroke(),i.beginPath(),m=p[0]*u+p[0]/2+(d?0:.5),i.moveTo(m,t(c[0].j)),i.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[2];for(var h=0,f=c.length;f>h;h++)m=p[0]*(u-h)+p[0]/2+(d?0:.5),i.lineTo(m,t(c[h].j));i.stroke(),s(),e.fillData[e.options.user.vIndicator.toUpperCase()]={data:c},e.fillBoxs[e.options.user.vIndicator.toUpperCase()]=l}},l.MTM=function(l){if(e.options.data.IND.MTM){for(var u=(e.options.data.IND.MTM.length,e.options.lens-1),c=[].concat(e.options.data.IND.MTM).reverse().slice(0,e.options.lens),p=e.options.level[e.options.user.level],d=p[0]/2!=(p[0]/2).toFixed(),m=p[0]*u+p[0]/2+(d?0:.5),h=0,f=c.length;f>h;h++)r=Math.max(c[h].mtm,r),r=Math.max(c[h].mtmma,r),a=Math.min(c[h].mtm,a),a=Math.min(c[h].mtmma,a);n=o(),verticalOffset=~~((i.h-e.options.user.offsetTop)*(.5-e.options.user.drawRange/2)+e.options.user.offsetTop),i.drawLine(r,a,n,2),i.beginPath(),i.lineWidth=1.5,m=p[0]*u+p[0]/2+(d?0:.5),i.moveTo(m,t(c[0].mtm)),i.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[0];for(var h=0,f=c.length;f>h;h++)m=p[0]*(u-h)+p[0]/2+(d?0:.5),i.lineTo(m,t(c[h].mtm));i.stroke(),i.beginPath(),i.lineWidth=1.5,m=p[0]*u+p[0]/2+(d?0:.5),i.moveTo(m,t(c[0].mtmma)),i.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[1];for(var h=0,f=c.length;f>h;h++)m=p[0]*(u-h)+p[0]/2+(d?0:.5),i.lineTo(m,t(c[h].mtmma));i.stroke(),s(),e.fillData[e.options.user.vIndicator.toUpperCase()]={data:c},e.fillBoxs[e.options.user.vIndicator.toUpperCase()]=l}},l.RSI=function(l){if(e.options.data.IND.RSI){for(var u=(e.options.data.IND.RSI.length,e.options.lens-1),c=[].concat(e.options.data.IND.RSI).reverse().slice(0,e.options.lens),p=e.options.level[e.options.user.level],d=p[0]/2!=(p[0]/2).toFixed(),m=p[0]*u+p[0]/2+(d?0:.5),h=0,f=c.length;f>h;h++)c[h].rsi1=1*(c[h].rsi1/100).toFixed(2),c[h].rsi2=1*(c[h].rsi2/100).toFixed(2),c[h].rsi3=1*(c[h].rsi3/100).toFixed(2),r=Math.max(c[h].rsi1,r),r=Math.max(c[h].rsi2,r),r=Math.max(c[h].rsi3,r),a=Math.min(c[h].rsi1,a),a=Math.min(c[h].rsi2,a),a=Math.min(c[h].rsi3,a);r=100,a=0,n=o(),verticalOffset=~~((i.h-e.options.user.offsetTop)*(.5-e.options.user.drawRange/2)+e.options.user.offsetTop),i.drawLine(r,a,n,2),i.beginPath(),i.lineWidth=1.5,m=p[0]*u+p[0]/2+(d?0:.5),i.moveTo(m,t(c[0].rsi1)),i.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[0];for(var h=0,f=c.length;f>h;h++)m=p[0]*(u-h)+p[0]/2+(d?0:.5),i.lineTo(m,t(c[h].rsi1));i.stroke(),i.beginPath(),i.lineWidth=1.5,m=p[0]*u+p[0]/2+(d?0:.5),i.moveTo(m,t(c[0].rsi2)),i.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[1];for(var h=0,f=c.length;f>h;h++)m=p[0]*(u-h)+p[0]/2+(d?0:.5),i.lineTo(m,t(c[h].rsi2));i.stroke(),i.beginPath(),m=p[0]*u+p[0]/2+(d?0:.5),i.moveTo(m,t(c[0].rsi3)),i.strokeStyle=e.options.schemes[e.options.user.schemes].iLines[2];for(var h=0,f=c.length;f>h;h++)m=p[0]*(u-h)+p[0]/2+(d?0:.5),i.lineTo(m,t(c[h].rsi3));i.stroke(),s(),e.fillData[e.options.user.vIndicator.toUpperCase()]={data:c},e.fillBoxs[e.options.user.vIndicator.toUpperCase()]=l}},i.clearInd=function(){i.clearRect(0,0,i.w,i.h),r=Number.MIN_VALUE,a=Number.MAX_VALUE,n=null},i.drawInd=function(o){var t=e.options.user.vIndicator;l[t.toUpperCase()]&&l[t.toUpperCase()](o)}}function _dataExchange(){function e(e){c=0,u=[],e&&i.loading.open();for(var t=0,s=a.data().length;s>t;t++)o(t,s)}function o(e,o){var t=a.data()[e],l=t.act;r.jsonp({url:n.options.url.xhr+l,data:t,success:function(e){e.success&&(c+=1,e.key=t.act.split("/").pop(),u.push(e),c==o&&(s(),i.draw(),i.loading.close()))}})}function t(){a.release(),i.options.user.timeShare?a.timeShare(i.options.user.stockID,i.options.user.ex):a.queryHistory(i.options.user.stockID,i.options.user.cyc,i.options.user.ex),e(),setTimeout(t,3e4)}function s(){for(var e=u.length;e--;)u[e].success&&l[u[e].key]&&l[u[e].key](u[e].data)}var i=this,n=i,r=request(),a=requestAPI(i),l=fireData(i),u={},c=0;i.getNewStock=function(){a.release(),n.options.data.DATA=[],n.options.data.DATAT={data:[],formatData:[]},i.options.user.timeShare?a.timeShare(i.options.user.stockID,i.options.user.ex):a.queryHistory(i.options.user.stockID,i.options.user.cyc,i.options.user.ex),e(1),window.ctrls&&ctrls.setOptional&&ctrls.setOptional()},!function(){"construct";totime(1*new Date,"ymd"),localStorage.getItem("ver");t()}.apply(window,arguments)}function requestAPI(e){function o(){return n=[]}function t(o,t,s,i){var i=i||500,r=e.options.cycMap[t||"1day"];return n.push({act:"/api/gjshq/candle/queryHistory",prodCode:encodeURIComponent(o+"."+s),cycle:r,number:i}),n}function s(e,o){return n.push({act:"/api/gjshq/snapshot/getMultiDaySnapshot",prodCode:encodeURIComponent(e+"."+o),type:1}),n}function i(){return n}var n=[],r={};return r.macd=function(e,o,t,s){n.push({act:"query_macd",code:o,exchange_short_name:t,limit:s})},r.rsi=function(e,o,t,s){n.push({act:"query_rsi",code:o,exchange_short_name:t,limit:s})},r.kdj=function(e,o,t,s){n.push({act:"query_kdj",code:o,exchange_short_name:t,limit:s})},{data:i,release:o,queryHistory:t,timeShare:s}}function fireData(e){function o(o){for(var t=o.length;t--;)o[t]={high:1*o[t].highPx.toFixed(2),low:1*o[t].lowPx.toFixed(2),open:1*o[t].openPx.toFixed(2),cur:1*o[t].closePx.toFixed(2),vol:1*o[t].businessAmount.toFixed(),date:new Date(o[t].minTime.slice(0,4),o[t].minTime.slice(4,6)-1,o[t].minTime.slice(6,8),o[t].minTime.slice(8,10),o[t].minTime.slice(10,12),o[t].minTime.slice(12,14)),rate:o[t].pxChangeRate};o.reverse(),e.options.data.DATA=o,l(o),u(o)}function t(o){if(o){o=o[0]?o[0].length?o[0]:o:[];for(var t=o.length;t--;)o[t]={avg:1*o[t].averagePx,preClosePx:1*o[t].preClosePx,pri:1*o[t].closePx,vol:1*o[t].businessAmount.toFixed(),datetime:new Date(o[t].minTime.slice(0,4),o[t].minTime.slice(4,6)-1,o[t].minTime.slice(6,8),o[t].minTime.slice(8,10),o[t].minTime.slice(10,12),o[t].minTime.slice(12,14))};o.reverse(),e.options.data.DATAT={formatData:[],data:o}}}function s(o){o&&(e.options.data.IND.MACD=o)}function n(o){o&&(e.options.data.IND.KDJ=o)}function r(o){o&&(e.options.data.IND.RSI=o)}function a(e,o,t,s){var i=0;if(s-1>o)return 0/0;for(var n=0;s>n;n++)i+=1*t[o-n][e];return i/s}function l(o){function t(e,t){i[e]["MA"+t]=t>e?0:a("cur",e,o,t)}var s=[5,10,20,30,60],i=[];if(o){for(var n=0,r=o.length;r>n;n++){i[n]={};for(var l=0;l<s.length;l++)t(n,s[l])}e.options.data.IND.KMA=i}}function u(o){function t(e,t){i[e]["MA"+t]=t>e?0:a("vol",e,o,t)}var s=[5,20],i=[];if(o){for(var n=0,r=o.length;r>n;n++){i[n]={};for(var l=0;l<s.length;l++)t(n,s[l])}e.options.data.IND.VMA=i}}function c(o,t,s){function i(){var e=d+p;return d=e-~~e,~~e}for(var n=e.options.data.DATAT.data,r=1,a=0,l=[],u=~~(o/t),c=o%t,p=c/t,d=0,m=0;t>m;m++)a=i(),r+=u+a,n[m]&&l.push({x:r-u+1*s,data:[n[m]],drawData:n[m]});return l}function p(o,t,s){function n(){var e=c+u,o=[];c=e-~~e;for(var t=0;~~e>t;t++)a[t+p]&&o.push(a[t+p]);return p+=~~e,o.length?o:[null]}var r,a=e.options.data.DATAT.data,l=[],u=t/o,c=0,p=0;for(i=1;o>=i;i++)r=n(),r[0]&&l.push({x:i+1*s,data:r,drawData:r[0]});return l}var d=e;return e.formatTimeData=function(o,t){var s=d.options.user.timesLens;e.options.data.DATAT.formatData=o>s?c(o,s,t):p(o,s,t)},{queryHistory:o,query_macd:s,query_kdj:n,query_rsi:r,getMultiDaySnapshot:t}}function _canvasLayout(e){var o,t=this;this.canvasLayout=function(s,i){var n=~~(e.options.user.viceHeight*s.h),r=~~(e.options.user.indicatorHeight*s.h),a=s.h-n-(e.options.layout[2]?r:0)-e.options.user.timeline,l=~~((1-e.options.user.timeHeight)*s.h),u=s.h-l-e.options.user.timeline,c=s.w>e.options.user.outRuleWidth;t.size&&t.size==s&&o==e.options.user.ctrlVer||(t.size=s,o=e.options.user.ctrlVer,i.volCanvas[0].style.cssText="top:"+a+"px;",i.timeVolCanvas[0].style.cssText="top:"+u+"px;",i.mainCanvas[0].width=s.w,i.volCanvas[0].width=s.w,i.toolsCanvas[0].width=s.w,i.timeCanvas[0].width=s.w,i.timeVolCanvas[0].width=s.w,e.options.layout[2]?(i.indCanvas[0].style.cssText="top:"+(a+n)+"px;",i.indCanvas[0].width=s.w,i.indCanvas[0].height=r,i.indCanvas[1].w=s.w,i.indCanvas[2].style.width=s.w-(c?e.options.user.ruleWidth:0)+"px",i.indCanvas[1].h=r,i.indCanvas[1].types=0,i.indCanvas[2].style.display=""):i.indCanvas[2].style.display="none",i.mainCanvas[0].height=a,i.volCanvas[0].height=n,i.toolsCanvas[0].height=s.h,i.timeCanvas[0].height=u,i.timeVolCanvas[0].height=l,i.mainCanvas[1].w=s.w,i.volCanvas[1].w=s.w,i.toolsCanvas[1].w=s.w,i.timeCanvas[1].w=s.w,i.timeVolCanvas[1].w=s.w,i.mainCanvas[2].style.width=s.w-(c?e.options.user.ruleWidth:0)+"px",i.volCanvas[2].style.width=s.w-(c?e.options.user.ruleWidth:0)+"px",i.timeCanvas[2].style.width=s.w-(c?e.options.user.ruleWidth:0)+"px",i.timeVolCanvas[2].style.width=s.w-(c?e.options.user.ruleWidth:0)+"px",i.timeCanvas[2].style.left=(c?e.options.user.ruleWidth:0)+"px",i.timeVolCanvas[2].style.left=(c?e.options.user.ruleWidth:0)+"px",i.mainCanvas[1].h=a,i.volCanvas[1].h=n,i.toolsCanvas[1].h=s.h,i.timeCanvas[1].h=u,i.timeVolCanvas[1].h=l,i.mainCanvas[1].types=1,i.volCanvas[1].types=0,i.toolsCanvas[1].types=1,i.timeCanvas[1].types=1,i.timeVolCanvas[1].types=0,e.options.user.w=s.w,t.size=s,t.splitWindows=function(){splitWindows(e,s,i,a,n,r,u,l)})}}function splitWindows(e,o,t,s,i,n,r,a){function l(t,s,i,n){var r=n&&n.x?n.x:0,a=n&&n.y?n.y:0;t.beginPath(),t.strokeStyle=e.options.schemes[e.options.user.schemes].layoutColor,t.moveTo(~~r+.5,~~a+.5),e.options.user.timeShare&&t.lineTo(~~r+.5,s-.5),t.moveTo(~~r+.5,s-.5),i?(t.lineTo(o.w,s-.5),t.moveTo(o.w-(u?e.options.user.ruleWidth:0)-.5,s-.5)):t.lineTo(o.w-(u?e.options.user.ruleWidth:0)-.5,s-.5),t.lineTo(o.w-(u?e.options.user.ruleWidth:0)-.5,~~a+.5),t.stroke()}var u;!function(){"construct";u=o.w>e.options.user.outRuleWidth,e.options.user.timeShare?(l(t.timeCanvas[1],r,1,{x:u?e.options.user.ruleWidth:0}),l(t.timeVolCanvas[1],a,0,{x:u?e.options.user.ruleWidth:0})):(l(t.mainCanvas[1],s,1),l(t.volCanvas[1],i,1),l(t.indCanvas[1],n,0))}.apply(window,arguments)}function _loading(e){var o=this;o.loading=function(){function o(){e.style.display="block"}function t(){e.style.display="none"}return{open:o,close:t}}()}function _bgLine(e){function o(){var e=i-n;return e?(p.h-a)/e:0}function t(e){return cutFixed(i-(e-a-.5)/r,2)}function s(o,s,i,n,r){p.fillText(shortIndex(0===n?n:n||1*t(s),l||0,e.options.user.binary,e.options.binary[e.options.user.binary],r),o+5,s)}var i,n,r,a,l,u,c,p=this;p.drawLine=function(o,t,c,d,m,h,f){{var v,g=p.w>e.options.user.outRuleWidth,T=(p.h-e.options.user.offsetTop)*(e.options.user.timeShare?1:e.options.user.drawRange),w=h||(p.types?e.options.user.minRuleHeight:e.options.user.vMinRuleHeight),y=~~(T/w),x=T/y,D=g?e.options.user.ruleWidth:0,b=e.options.user.timeShare?D:0;(p.w-2*D)/8}if(r=c,l=d,u=!1,m?(a=e.options.user.offsetTop,--y):a=~~((p.h-e.options.user.offsetTop)*(.5-e.options.user.drawRange/2)+e.options.user.offsetTop),i=o,n=t,o!=t){p.font="12px arial",p.textBaseline="middle",p.lineWidth=1,p.strokeStyle=e.options.schemes[e.options.user.schemes].layoutColor,p.fillStyle=e.options.schemes[e.options.user.schemes].layoutFont,p.beginPath();for(var S=0;y>=S;S++)v=0==S?i:S!=y||m?null:n,p.moveForDashed(b,a+S*x-.5),p.dashedLineTo(p.w-D,a+S*x-.5,2),s(p.w-D+2,a+S*x-.5,c,v,f);p.stroke(),p.drawZeroLine=function(e){}}},p.drawTimeLine=function(t,s,u,d,m,h){function f(e){return cutFixed((i-c)*e/(x-1),2)}function v(o,t,s,i,n){var r;i>0?(p.fillStyle=e.options.schemes[e.options.user.schemes].riseFont,r=1*f(n)+c):0==i?(r=c,p.fillStyle=e.options.schemes[e.options.user.schemes].fontColor):(p.fillStyle=e.options.schemes[e.options.user.schemes].fallFont,r=c-f(n)),p.font="12px arial",p.textAlign=h?"right":"left",p.textBaseline="middle",p.fillText(shortIndex(r,l||0,e.options.user.binary,e.options.binary[e.options.user.binary]),D-(h?5:-2),t),p.textAlign=h?"left":"right",p.fillText(shortIndex(100*(r-c)/c,l||0,e.options.user.binary,e.options.binary[e.options.user.binary])+"%",o+(h?5:-2),t)}{var g,T,w=~~((p.h-e.options.user.offsetTop)/2+e.options.user.offsetTop),y=e.options.user.timeLineMinRuleHeight,x=~~((p.h-e.options.user.offsetTop)/y),D=h?e.options.user.ruleWidth:0;(p.w-2*D)/8}if(i=t,n=s,x=(x%2?x-1:x)/2,g=(p.h-e.options.user.offsetTop)/(2*x),e.options.unit=g,c=1*m,l=d,a=e.options.user.offsetTop,r=o(),t!=s){if(p.strokeStyle=e.options.schemes[e.options.user.schemes].layoutColor,p.lineWidth=1,p.beginPath(),h)for(var b=1;x>b;b++)T=cutFixed(w-b*g-.5,0),p.moveTo(D,T),p.lineTo(p.w-D,T),T=cutFixed(b*g+(w-.5),0),p.moveTo(D,T),p.lineTo(p.w-D,T);else T=cutFixed(w-(x-1)*g-.5,0),p.moveTo(D,T),p.lineTo(p.w-D,T),T=cutFixed((x-1)*g+(w-.5),0),p.moveTo(D,T),p.lineTo(p.w-D,T);if(p.stroke(),p.beginPath(),h){for(var b=1;x>b;b++)T=cutFixed(w-b*g-.5,0),v(p.w-D+2,T,u,1,b),T=cutFixed(b*g+(w-.5),0),v(p.w-D+2,T,u,-1,b);T=cutFixed(w-.5,0),v(p.w-D+2,T,u,0,0)}else T=cutFixed(w-(x-1)*g-.5,0),v(p.w,T,u,1,x-1),T=cutFixed((x-1)*g+(w-.5),0),v(p.w,T,u,-1,x-1);p.beginPath(),p.strokeStyle=e.options.schemes[e.options.user.schemes].layoutColor,p.lineWidth=e.options.schemes[e.options.user.schemes].specialLine?3:1,p.moveTo(D,w-.5),p.lineTo(p.w-D,w-.5),p.stroke(),p.lineWidth=1}}}function _domctrl(){function e(){var e=o.domlist.market.getElementsByTagName("ul"),t=o.domlist.market.getElementsByTagName("script"),i=o.domlist.market.querySelector("div");s.market={sel:{dom:e[0],str:t[0].innerHTML},buy:{dom:e[1],str:t[2].innerHTML},cur:{dom:i,str:t[1].innerHTML}}}var o=this,t=o,s={};o.stockInfo=function(){o.domlist.stock&&(s.stock||(s.stock=o.domlist.stock.querySelector("script").innerHTML),o.domlist.stock.innerHTML=rentmpl(s.stock,{data:t.options.data.DATA2}))},o.market=function(){s.market||e(),s.market.sel.dom.innerHTML=rentmpl(s.market.sel.str,{data:t.options.data.MARKET.bid,pre:t.options.data.MARKET.pre}),s.market.buy.dom.innerHTML=rentmpl(s.market.buy.str,{data:t.options.data.MARKET.ask,pre:t.options.data.MARKET.pre}),s.market.cur.dom.innerHTML=rentmpl(s.market.cur.str,{cur:t.options.data.MARKET.cur,pre:t.options.data.MARKET.pre}),o.tradeForm&&(o.tradeForm.buy.inputs[0].getAttribute("cooldown")||(o.tradeForm.buy.inputs[0].value=t.options.data.MARKET.bid[t.options.data.MARKET.bid.length-1].pri),o.tradeForm.sell.inputs[0].getAttribute("cooldown")||(o.tradeForm.sell.inputs[0].value=t.options.data.MARKET.ask[0].pri))},o.tradeHistory=function(){s.tradeHistory||(s.tradeHistory={str:o.domlist.tradeHistory.querySelector("script").innerHTML,dom:o.domlist.tradeHistory.querySelector("ul")}),s.tradeHistory.dom.innerHTML=rentmpl(s.tradeHistory.str,{data:t.options.data.TRADELIST.reverse(),pre:t.options.data.MARKET.pre})}}function _keymap(){var e,o=this,t=o,s=[{ex:"0",code:"KDJ",name:"随机指标",action:"actionSetInd"},{ex:"0",code:"MACD",name:"指数平滑异同平均线",action:"actionSetInd"},{ex:"0",code:"MTM",name:"动量线",action:"actionSetInd"}];s=JSON.stringify(s),o.setKeyMap=function(o){if(e=window.MAP||t.options.data.MAP,o){var i=new RegExp('\\{[^\\}]*"code":"[\\.]*'+o+"[^\\}]*}","gi"),n=new RegExp('\\{[^\\}]*"spell":"[\\.]*'+o+"[^\\}]*}","gi"),r=window.HASINDKEY&&t.options.hasInd[t.options.user.cyc]?s.match(i)||[]:[];return r.concat(e.match(i)||e.match(n)||[])}}}function _event(e,o){function t(){d||(Event.add(document,"keydown",r),Event.add(document,"keyup",a),J(_action,m,e,o,m.domlist?m.domlist.shortcut:document.querySelector("#shortcut"))),d=1,Event.add(document,"click",l),Event.add(e,"click",u),document.querySelector("#shortcut")&&(c=(m.domlist?m.domlist.shortcut:document.querySelector("#shortcut")).parentNode.getElementsByTagName("input")[0],Event.add(c,"focus",function(){p=1}),Event.add(c,"blur",function(){p=0}))}function s(e){return e&&e.parentNode?e.getAttribute("stop")?e:s(e.parentNode):null}function i(e){var e=window.event||e,o=e.keyCode,t=Event.target(e),i=t.getAttribute("act");return"getusable"==i?t.setAttribute("cooldown",1):h.options.user.timeShare||h.shortcutIsShow||38!=o?h.options.user.timeShare||h.shortcutIsShow||40!=o?(h.options.user.timeShare&&!h.shortcutIsShow&&13==o&&h.kt("k"),void(s(t)||116==o||123==o||8==o&&!p)):h.setLevel(-1):h.setLevel(1)}function n(e){var e=window.event||e,o=e.keyCode,t=Event.target(e),i=t.getAttribute("act");if(!s(t)&&116!=o&&123!=o&&(8!=o||p))return m[i]?m[i](e):void Event.stop(e)}function r(e){var o=Event.target(e);s(o)||(i(e),n(e))}function a(e){var o=Event.target(e);s(o)||n(e)}function l(e){var e=window.event||e,o=Event.target(e),t=attFather(o,"act")?attFather(o,"act")[1]:null,s=attFather(o,"shortcut"),i=attFather(o,"stop"),n=attFather(o,"data-val");i&&Event.stop(e),!s&&m.shortcutIsShow&&m.shortcutHidden(),m[t]&&m[t](o,n[1],e)}function u(){}var c,p,d,m=this,h=m;h.crossStart=1,!function(){"construct";t(),Event.add(e,"mouseover",m.mouseover),Event.add(e,"mousemove",m.mousemove),Event.add(e,"mouseout",m.mouseout)}.apply(window,arguments)}function _action(e,o,t){function s(e){{var o=t.getElementsByTagName("li"),s=(e+1)*o[0].offsetHeight;t.scrollTop+t.offsetHeight}r&&dom.hasClass(r,"on")&&dom.removeClass(r,"on"),r=o[e],s-=t.offsetHeight,t.scrollTop=s>0?s:0,!dom.hasClass(r,"on")&&dom.addClass(r,"on")}function i(t){var s=Event.mouse(t),i=c.options.level[c.options.user.level];if(!l){l=1;var n=e.size.w>c.options.user.outRuleWidth,r=s.x-dom.getPosition(e).x-(c.options.user.timeShare&&n?c.options.user.ruleWidth:0);!c.options.user.timeShare&&c.kBox&&(c.kBox.style.left="5px"),o.toolsCanvas[1].crossLine(r,s.y-dom.getPosition(e).y+(document.documentElement.scrollTop||document.body.scrollTop),i[0]),o.toolsCanvas[1].drawTimeAndVol(r,s.y-dom.getPosition(e).y,i[0]),setTimeout(function(){l=0
},20)}}var n,r,a,l,u=this,c=u,p={},d=besideTip(),m=0,h=-1;u.keyMapInput=function(e){var o,i,a,l=Event.target(e).value,c=e.keyCode,d=e.type;if(o=l?u.setKeyMap(l)||[]:[],n==l){if((38==c||40==c)&&Event.stop(e),"keyup"==d.toLowerCase())return;if(38==c?h+=-1:40==c&&(h+=1),(38==c||40==c)&&(0>h&&(h=0),h>=m&&(h=m-1),s(h,c)),13==c){if(a=h>0?h:0,i=o[a],u.shortcutHidden(),t.parentNode.getElementsByTagName("input")[0].value="",!i)return;u.changeStock(JSON.parse(i),1)}}else{if(n=l,r=null,h=-1,o.splice(50,1e5),o=JSON.parse("["+o.join(",")+"]"),m=o.length,!p.shortcut&&!t.querySelector("script"))return;p.shortcut||(p.shortcut=t.querySelector("script").innerHTML),t.innerHTML=rentmpl(p.shortcut,{data:o})}},u.shortcutShow=function(e){c.shortcutIsShow=1,e.parentNode.parentNode.style.bottom=0},u.shortcutHidden=function(){c.shortcutIsShow=0,t.parentNode.getElementsByTagName("input")[0].value="",t.parentNode.parentNode.style.bottom=-1*t.parentNode.parentNode.offsetHeight+"px"},u.changeStock=function(e,o){var t=e.ex,s=e.code;return e.action?u[e.action]&&u[e.action](e):window.MAP&&o?window.location.href="stock.html?id="+s+"&ex="+t:(u.options.user.stockID=e.code,u.options.user.ex=e.ex,c.options.user.ctrlVer=1*new Date,void u.getNewStock())},u.goDetail=function(e,o){var t=o.split("/"),s=t[0],i=t[1];u.shortcutHidden(),window.location.href="stock.html?id="+i+"&ex="+s},u.clickChangeStock=function(e,o){var t=o.split("/"),s=t[0],i=t[1];u.options.user.stockID=i,u.options.user.ex=s,c.options.user.ctrlVer=1*new Date,u.getNewStock(),u.shortcutIsShow&&u.shortcutHidden()},u.actionSetInd=function(e,o){var t=o&&o.split("/");return c.options.hasInd[c.options.user.cyc]?!o&&e.code?u.setInd(e.code):void(t[1]&&u.setInd(t[1],c.options.user.vIndicator.toLowerCase()!=t[1]||c.options.user.timeShare)):d.changeObj(e).top().notice("当前周期下没有这个指标数据",2e3,"warning")},u.changePeriod=function(e,o){o&&(c.options.user.cyc!=o||c.options.user.timeShare)&&(c.options.user.timeShare=0,c.options.layout=[1,1,c.options.hasInd[o]],c.options.data.DATA=[],c.options.data.DATA2={},c.options.data.IND={},c.options.user.cyc=o,c.winReset(),c.getNewStock())},u.cross=function(e,t,s){c.kBox&&(c.kBox.style.left="-299px"),c.crossStart?(c.crossStart=0,u.mouseout(s),o.toolsCanvas[1].clear()):(c.crossStart=1,u.mouseover(s),u.mousemove(s),!c.options.user.timeShare&&c.kBox&&(c.kBox.style.left="22px"))},u.mouseover=function(){c.crossStart&&(clearTimeout(a),a=null)},u.mousemove=function(e){c.crossStart&&i(e)},u.mouseout=function(){o.toolsCanvas[1].clear(),o.toolsCanvas[1].drawTimeAndVol(c.options.lens-1,null,null),!c.options.user.timeShare&&c.kBox&&(c.kBox.style.left="-295px")},u.historyGo=function(){return c.crossStart?u.cross():c.shortcutIsShow?u.shortcutHidden():void(c.options.user.timeShare?"index.html"==window.location.href.split("/").pop()||c.options.user.popstop||(window.location.href="./index.html"):c.kt())},u.doubleAction=function(){return c.options.user.timeShare&&c.options.user.double?c.kt():void 0}}function _tools(e,o){function t(o,t,s,i){for(var n,r=e.options.data.DATAT.formatData,a=i+s,l=0,u=r.length;u>l&&!(r[l].x>a);l++)n=r[l].x;return r[l]&&(!n||Math.abs(n-a)>Math.abs(r[l].x-a))?[r[l].x,l]:[n,l-1]}function s(o,t,s,n){function r(){var e=p+c,o=[];p=e-~~e;for(var t=0;~~e>t;t++)l[t+d]&&o.push(l[t+d]);return d+=~~e,o.length?o:[null]}var a,l=e.options.data.DATAT.data,u=[],c=t/o,p=0,d=0;for(i=0;o>i;i++)a=r(),a[0]&&u.push({x:n,data:a,drawData:a[0]});return[n+s,n]}function n(i,n,r,a){var l=o.size.w-2*(a?e.options.user.ruleWidth:0)-2,u=i,c=l>e.options.user.timesLens?t(l,e.options.user.timesLens,a?e.options.user.ruleWidth:0,u):s(l,e.options.user.timesLens,a?e.options.user.ruleWidth:0,u),n=~~(n-(document.documentElement.scrollTop||document.body.scrollTop))-.5;return[c[0]+.5,n,c[1]]}function r(o,t,s,i){var o=~~(o/s),n=o>=e.options.lens?e.options.lens-1:0>o?0:o,o=~~(n*s+s/2+1*(e.options.user.timeShare&&i?e.options.user.ruleWidth:0))+.5,t=~~(t-(document.documentElement.scrollTop||document.body.scrollTop))-.5;return[o,t,n]}var a,l=this;l.crossLine=function(t,s,i){var a=o.size.w>e.options.user.outRuleWidth,u=e.options.user.timeShare?n(t,s,i,a):r(t,s,i,a);l.clear(),l.beginPath(),l.strokeStyle=e.options.schemes[e.options.user.schemes].crossLine,l.moveTo(u[0],0),l.lineTo(u[0],l.h-e.options.user.timeline),u[1]<l.h-e.options.user.timeline&&(l.moveTo(e.options.user.timeShare&&a?e.options.user.ruleWidth:0,u[1]),l.lineTo(l.w-(a?e.options.user.ruleWidth:0),u[1])),l.stroke()},l.clear=function(){l.clearRect(0,0,l.w,l.h)},l.drawTimeAndVol=function(t,s,i){var l=o.size.w>e.options.user.outRuleWidth,u=e.options.user.timeShare?n(t,s,i,l):r(t,s,i,l),c=u[2];null===s&&null===i&&(c=null),a!=c&&(e.fillCurData(c),a=c)}}function _fillData(e){var o,t=this,s=t,i={timeShare:'<%if(outRule){%><em><%=data.name%></em><%}%><em><%=totime(obj.drawData.datetime,"m-d h:i:s")%></em><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[0]%>">最新：<%=(obj.drawData.pri*1).toFixed(2)%></em><% if(obj.drawData.avg !== null && obj.drawData.type*1 && 0){%><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[1]%>">均价：<%=(obj.drawData.avg*1).toFixed(2)%></em><% } %><%if(outRule){%><em style="color:<%=(obj.pri*1 > cfg.data.DATA2.pre*1 ? cfg.schemes[cfg.user.schemes].rise : cfg.schemes[cfg.user.schemes].fall)%>">量：<%=obj.drawData.vol%></em><%}%>',k:'<%if(outRule){%><em><%=data.name%></em><%}%><%if(data.ind[i]){var j = 0; for(k in data.ind[i]){%><% if(data.ind[i][k]){%><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[j++]%>"><%=k%>:<%=cutFixed(data.ind[i][k],2)%></em><%}%><%}%><%}%>',vol:'<em style="color:<%=(obj.cur * 1 > obj.open ? cfg.schemes[cfg.user.schemes].rise :cfg.schemes[cfg.user.schemes].fall)%>">总手：<%=obj.vol%></em><%if(data.ind[i]){var j = 0; for(k in data.ind[i]){%><% if(data.ind[i][k]){%><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[j++]%>"><%=k%>:<%=cutFixed(data.ind[i][k],2)%></em><%}%><%}%><%}%>',MACD:'<em>MACD(12,26,9)</em><%if(outRule){%><em style="color:<%=(cfg.schemes[cfg.user.schemes][obj.macd > 0 ? "MACDrise" : "MACDfall"])%>">MACD：<%=obj.macd%></em><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[0]%>">DIFF：<%=obj.dif%></em><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[1]%>">DEA：<%=obj.dea%></em><%}%>',KDJ:'<em>KDJ(9,3,3)</em><%if(outRule){%><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[0]%>">K：<%=cutFixed(obj.k,2)%></em><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[1]%>">D：<%=cutFixed(obj.d,2)%></em><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[2]%>">J：<%=cutFixed(obj.j,2)%></em><%}%>',RSI:'<em>RSI(6,12,24)</em><%if(outRule){%><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[0]%>">RSI6：<%=cutFixed(obj.rsi1,2)%></em><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[1]%>">RSI12：<%=cutFixed(obj.rsi2,2)%></em><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[2]%>">RSI24：<%=cutFixed(obj.rsi3,2)%></em><%}%>',kbox:'<ul><li>日期：<i><%=totime(obj.date,"y-m-d")%></i></li><li>时间：<i><%=totime(obj.date,"h:i:s")%></i></li><li>开盘：<i class="<%if(obj.open*1 > pre){%>red<%}else if(obj.open*1 <pre){%>green<%}%>"><%=obj.open%></i></li><li>最高：<i class="<%if(obj.high*1 > pre){%>red<%}else if(obj.high*1 <pre){%>green<%}%>"><%=obj.high%></i></li><li>最低：<i class="<%if(obj.low*1 > pre){%>red<%}else if(obj.low*1 <pre){%>green<%}%>"><%=obj.low%></i></li><li>收盘：<i class="<%if(obj.cur*1 > pre){%>red<%}else if(obj.cur*1 < pre){%>green<%}%>"><%=obj.cur%></i></li><li>涨幅：<i class="<%if(obj.rate > 0){%>red<%}else if(obj.rate < 0){%>green<%}%>"><%=cutFixed(obj.rate,3)%>%</i></li><li>振幅：<i class="blue"><%=cutFixed((obj.high - obj.low)*100/pre,3)%>%</i></li></ul>',MTM:'<em>MTM(12,6)</em><%if(outRule){%><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[0]%>">MTM：<%=cutFixed(obj.mtm,2)%></em><em style="color:<%=cfg.schemes[cfg.user.schemes].iLines[1]%>">MTMMA：<%=cutFixed(obj.mtmma,2)%></em><%}%>'};t.fillCurData=function(n){var r,a;if(o=e.size.w>s.options.user.outRuleWidth,s.options.user.showInfo)for(var l in s.fillBoxs)r=s.fillData[l],a=null===n?r.data.length-1:n,a=r.data.length-a-1,r.data[a]&&(s.fillBoxs[l].innerHTML=rentmpl(i[l],{data:r,code:t.options.user.stockID,i:a,obj:r.data[a],cfg:s.options,outRule:o}),"k"===l&&s.kBox&&(s.kBox.innerHTML=rentmpl(i.kbox,{data:r,pre:r.data[a+1]?1*r.data[a+1].cur:1*r.data[a].open,code:t.options.user.stockID,i:a,obj:r.data[a],cfg:s.options,tl:s.options.cycMap[s.options.user.cyc],outRule:o})))}}var CFG={level:[[84,75],[78,69],[72,63],[66,57],[58,51],[54,47],[50,43],[46,39],[40,35],[36,31],[32,27],[30,25],[28,23],[26,21],[22,19],[20,17],[18,15],[16,13],[14,11],[12,9],[10,7],[8,5],[6,3],[3,1],[1,1]],url:{xhr:window.httpUrl||"172.32.1.218:8097"},fingerprint:"caimao.com",schemes:{chinese:{rise:"#ff0000",riseStyle:"0",fall:"#54fcfc",fallStyle:"1",riseFont:"#ff0000",fallFont:"#00ff00",timeVolRise:"#ffff0b",timeVolFall:"#02e2f4",timeVolStable:"#ffffff",timeShareShadow:0,specialLine:1,shadowFill:"rgba(200, 23, 23, 0.15)",MACDrise:"#ff3232",MACDfall:"#00ff00",crossLine:"#ccc",layoutColor:"#800000",layoutFont:"#ff2b1c",fontColor:"#c4c4c4",iLines:["#ffffff","#ffff0b","#ff80b6","#00e600","#02e2f4","#ffffb9","#2c684d","#ff3232"],background:"#000000"},mobile:{rise:"#eb4636",riseStyle:"0",fall:"#6cbf0a",fallStyle:"1",riseFont:"#eb4636",fallFont:"#6cbf0a",timeVolRise:"#eb4636",timeVolFall:"#6cbf0a",timeVolStable:"#5588cc",timeShareShadow:1,specialLine:0,shadowFill:"rgba(71, 169, 238, 0.15)",MACDrise:"#eb4636",MACDfall:"#6cbf0a",crossLine:"#ccc",layoutColor:"#dcdbdb",layoutFont:"#999",fontColor:"#999",iLines:["#5588cc","#fcc83b","#ff80b6","#00e600","#02e2f4","#ffffb9","#2c684d","#ff3232"],background:"#fff"}},binary:{1e3:["K","M","B"],1e4:["万","亿","兆"]},layout:[1,1,1],cycMap:{"1week":7,"1month":8,"1day":6,"1min":1,"5min":2,"15min":3,"30min":4,"1hour":5,timeshare:10},hasInd:{"1day":1,"1week":1,"1month":1,"1min":1,"5min":1,"15min":1,"30min":1,"1hour":1},hasKma:{"1day":1,"1week":1,"1month":1,"1min":1,"5min":1,"15min":1,"30min":1,"1hour":1},user:{showInfo:1,"double":1,dataVersion:"0.1",timesLens:242,popstop:0,ctrlVer:1*new Date,paddingRight:15,outRuleWidth:414,binary:1e4,symbol:0,schemes:"mobile",offsetTop:20,ruleWidth:60,viceHeight:.3,indicatorHeight:0,timeHeight:2/3,level:2,cyc:"60min",indicator:"MA",vIndicator:"MACD",drawRange:.8,minRuleHeight:75,vMinRuleHeight:40,timeLineMinRuleHeight:30,timeline:0,timeSpace:140,dashed:1,timeShare:0,stopDrag:0,stopZoom:0,showHigh:1,showLow:1,doubleClick:300,moveThreshold:999999},data:{DATA:[],DATAT:{formatData:[],data:[]},DATA2:{},MARKET:{},TRADELIST:[],MAP:"",IND:{}}};